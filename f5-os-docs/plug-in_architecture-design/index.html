<!doctype html>
<html lang="en">
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!--<head>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>LBaaS Plug-in Architecture and Design</title>
    
    <!-- Site metadata -->
    <meta name="description" content="Uniquely cloud-ready">

    <!--styles-->
    <link rel="stylesheet" href="../assets/css/bootstrap-docs.css" type="text/css">
    <link rel="stylesheet" href="../assets/css/f5-styles.css" type="text/css">

    <!--link rel="canonical" href="http://F5Networks.github.io/f5-openstack-docs/f5-os-docs/plug-in_architecture-design/"-->

    <link rel="alternate" type="application/rss+xml" title="F5 OpenStack" href="http://F5Networks.github.io/f5-openstack-docsfeed.xml" />
   
  </head>

 -->
<head>
  <title>LBaaS Plug-in Architecture and Design</title>
      
<!-- tocify by Greg Franko gfranko / jquery.tocify.js-->
<!DOCTYPE html>
<html lang="en">

    <!-- tocify styles-->
    <link type="text/css" rel="stylesheet" href="../assets/css/jquery.tocify.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/bootstrap.css">

    <!-- tocify scripts-->
    <script src="http://code.jquery.com/jquery-1.11.3.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="../assets/js/jquery.tocify.js"></script>

    

</head>
      
<body>
    <!--<!DOCTYPE html lang="en">
<link href="http://F5Networks.github.ioassets/css/f5-styles.css" rel="stylesheet" type="text/css">

<header id="F5-Header" class="meta-open animate">
  <div class="main-row">
  <div class="container">
      <div class="outside">
            <div class="brand">
            <a href="http://f5.com"><img src="https://cdn.f5.com/digital-platforms/images/logo.svg" alt="F5 Networks" height="42" width="47"></a>
			</div>
            <div class="nav-inline">
            <ul class="main-nav" id="MainMenu">                
               
                <li><a class="externalLink" href="http://devcentral.f5.com">DevCentral</a></li>
				        
                <li><a class="externalLink" href="http://support.f5.com">Support</a></li>
                
                <li><a class="page-link" href="http://F5Networks.github.io">Documentation</a></li>
                
                <li><a class="externalLink" href="http://www.openstack.org/">OpenStack</a></li>
            </ul>
            </div>
        </div>
    </div>
  </div>  
      <!--div class="trigger">
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/Cloud-and-SDN-Overview/">Cloud and SDN Overview</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/Demo-and-Testing-Tools-Guide/">OpenStack Demo and Testing Tools</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/F5-Platforms-for-Cloud-Guide/">F5 Platforms for Cloud</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/Int-Cloud-Services-Overview/">Cloud Services Overview</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/LBaaS-Plugin-Design-Guide/">LBaaS Plugin Design Guide</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/LBaaS-Solution-Overview/">LBaaS Solution Overview</a>
          
        
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/">F5 OpenStack Docs Index</a>
          
        
          
          <a class="page-link" href="http://F5Networks.github.io/f5-os-docs/plug-in_architecture-design/">LBaaS Plug-in Architecture and Design</a>
          
        
      </div-->
</header>
 -->
     
    <div class="container">
      <div class="bs-docs-header">
      <h1>LBaaS Plug-in Architecture and Design</h1>
      </div>
    </div>

    <div class="bs-docs-sidebar">
        <div class="bs-docs-sidenav" id="toc">
        </div>
    </div>


  <div class="bs-docs-container">
	
		 <p>#F5 LBaaS Plug-in Architecture and Design</p>

<p>##Overview</p>

<p>OpenStack defines standard services in terms of command line, API, and<br />
GUI interfaces. Services can be implemented via plug-ins.</p>

<p>The F5 LBaaS plug-in for the Neutron load balancing service uses existing OpenStack python classes to implement its primary service functions.</p>

<p>The F5 LBaaS plug-in is delivered as two packages, each of which contains python code, configuration scripts, and accompanying materials:</p>

<ul>
  <li>the Plug-in;</li>
  <li>the Agent.</li>
</ul>

<p>The F5 LBaaS Plug-in passes LBaaS requests off to the F5 LBaaS Agent, which provisions network resources.</p>

<p>Multiple agents can run simultaneously; each agent handles requests for a specific subset of the tenants.<br />
<strong>__</strong><strong>__</strong>_</p>

<h2 id="components">Components</h2>

<p>The F5 LBaaS solution is comprised of three major deliverables:</p>

<ol>
  <li>
    <p>F5 LBaaS Plug-in Package</p>
  </li>
  <li>
    <p>F5 LBaaS Agent Package</p>
  </li>
  <li>
    <p>F5 BIG-IP Application Delivery Controller</p>
  </li>
</ol>

<p>The deliverables can be broken down into the following major solution<br />
components:</p>

<ul>
  <li>
    <p><strong>Neutron Server</strong>: Receives LBaaS API requests. Neutron is part of OpenStack and must be set up and working <em>before</em> the F5 LBaaS solution is installed. <em>F5 Networks does not sell, implement, or support OpenStack</em>.</p>
  </li>
  <li>
    <p><strong>F5 LBaaS Service Plug-in</strong>: Accepts F5 LBaaS requests from Neutron.</p>
  </li>
  <li>
    <p><strong>F5 LBaaS Service Plug-in Driver (F5PluginDriver)</strong> (loaded by the F5 service plug-in): Handles F5 LBaaS requests on behalf of the Plug-in; selects an Agent; passes request to the Agent via a messaging-based Remote Procedure Call.</p>
  </li>
  <li>
    <p><strong>F5 LBaaS Agent</strong>: Responsible for handling the LBaaS requests for a subset of tenants. Each agent can utilize one BIG-IQ and/or one BIG-IP Device Service Group (‘DSG’; also called a cluster) to set up the service for its tenants. The Agent loads an Agent Manager, to which it delegates all requests.</p>
  </li>
  <li>
    <p><strong>F5 LBaaS Agent Manager</strong>: Runs in the F5 LBaaS Agent. The Agent Manager loads the F5 Agent Driver; handles  requests from the Service Plug-in; and passes request to the F5 Agent Driver.</p>
  </li>
  <li>
    <p><strong>F5 LBaaS Agent Driver</strong>: Runs in the F5 Agent. The Agent Driver takes requests from the Agent Manager and configures BIG-IP or passes them to BIG-IQ (depending on the setup being used).</p>
  </li>
  <li>
    <p><strong>BIG-IP Device Service Group</strong> (DSG, or cluster): One or more BIG-IP devices or BIG-IP VE instances.<br />
<strong>__</strong><strong>__</strong><strong>__</strong></p>
  </li>
</ul>

<h2 id="configurations">Configurations</h2>

<h3 id="single-agent">Single Agent</h3>

<p>In a Single Agent setup (Figure 1), each agent manages one BIG-IP DSG.</p>

<p><img src="architecture_single-agent-diagram.png" alt="" title="Figure 1" /></p>

<h3 id="multiple-agent">Multiple Agent</h3>

<p>In a Multiple Agent setup (Figure 2), multiple agents are installed; each agent automatically handles a specific subset of the tenants.</p>

<p><img src="architecture_multi-agent-diagram.png" alt="" title="Figure 2" /></p>

<h3 id="agent-tenant-affinity">Agent-Tenant Affinity</h3>

<p>The F5 LBaaS solution permanently maps a tenant to a particular agent (Figure 3).</p>

<p><img src="architecture_agent-tenant-affinity.png" alt="" title="Figure 3" /><br />
<strong>__</strong><strong>__</strong>_</p>

<h2 id="components-1">Components</h2>

<h3 id="plug-in-driver">Plug-in Driver</h3>

<p>The plug-in driver processes individual LBaaS API calls. It converts calls to F5 LBaaS Service Requests and passes them to the F5 LBaaS agent.</p>

<h3 id="agent-manager">Agent Manager</h3>

<p>The agent manager receives RPC calls and relays them to the agent driver.</p>

<h3 id="agent-driver-icontrol">Agent Driver (iControl)</h3>

<p>The agent driver configures all aspects of the service. The driver leverages  “Builder” classes to configure networking on BIG-IP.</p>

<h4 id="builder-classes">Builder Classes</h4>

<ul>
  <li>
    <p><strong>Network Builder</strong>: Used to configure all of the necessary networking for a service definition on BIG-IP.</p>
  </li>
  <li>
    <p><strong>LBaaS Builder</strong>: Creates high-level objects for the service, such as the pool, pool members, vip, and monitors. It can either deploy an iApp to BIG-IP or configure BIG-IP directly.</p>
  </li>
</ul>

<h3 id="configuration-managers">Configuration Managers</h3>

<p>Configuration managers address object-definition conflicts that can arise from differences in terminology.</p>

<ul>
  <li><strong>tenant</strong>, <strong>l2</strong>, <strong>selfip</strong>, <strong>snat</strong>, <strong>pool</strong>, and <strong>vip</strong> managers: Convert OpenStack LBaaS service-defined objects to their corresponding F5-defined counterparts.</li>
  <li><strong>vCMP manager</strong>: Talks to the vCMP host to assign VLANs to a guest.<br />
<strong>__</strong><strong>__</strong>_</li>
</ul>

<h2 id="service-definition">Service Definition</h2>

<p>Requests come in to the F5 LBaaS agent as full service definitions. The driver looks up networks, mac entries, segmentation info, etc., and places the information in a service object (which is a python dictionary variable). It then passes that service object to the agent.</p>

<p>Figure 4 is a simplified example of a service definition.</p>

<p><img src="architecture_service-definition.png" alt="" title="Figure 4" /></p>

<h2 id="plug-in-classes">Plug-in Classes</h2>

<p>The F5 LBaaS Plug-in Driver runs in the Neutron process and has access<br />
to all the methods and data that Neutron uses.</p>

<ul>
  <li>
    <p>F5PluginDriver: Called as the F5 LBaaS “provider” in the Neutron server config file. It receives the method calls for the LBaaS service. This class is derived from a Neutron class named “LoadBalancerAbstractDriver”.</p>
  </li>
  <li>
    <p>LoadBalancerAgentApi: Interface for RPC calls to agents.</p>
  </li>
  <li>
    <p>LoadBalancerCallbacks: Handles requests from the agent.</p>
  </li>
  <li>
    <p>TenantScheduler: Assigns an agent to handle an operation on a load-balancing pool.</p>
  </li>
</ul>

<h3 id="agent-processes">Agent Processes</h3>

<p>The agent runs as a standalone process with its own startup, configuration, and logging files.</p>

<p>The <strong>execution script</strong> – a short python program which imports the agent and runs the main function – is <em>/usr/bin/f5-bigip-lbaas-agent</em>.</p>

<p>The <strong>startup script</strong> – which passes all the appropriate command line options to specify the config and logging files – is in the <em>/etc/init</em> directory.</p>

<p>The <strong>main agent process entry point</strong> is in <em>agent.py</em>. The main program<br />
creates an instance of LbaasAgentManager (from the agent_manager<br />
module), which in turn creates an instance of the agent driver, which<br />
is, by default, the iControlDriver class in the icontrol_driver module.<br />
<strong>__</strong><strong>__</strong>_____</p>

<h2 id="rpc-classes">RPC Classes</h2>

<h3 id="overview">Overview</h3>

<p>The LBaaS Driver and Agents communicate using the Neutron server’s RPC classes.</p>

<h4 id="driver-to-agent">Driver to Agent</h4>

<p>The driver calls the agent for the following:</p>

<ul>
  <li>process all LBaaS methods.</li>
</ul>

<h4 id="agent-to-driver">Agent to Driver</h4>

<p>The agent calls the driver for the following:</p>

<ul>
  <li>
    <p>update the status of LBaaS objects;</p>
  </li>
  <li>
    <p>allocate a port on a Neutron network;</p>
  </li>
  <li>
    <p>make a query to Neutron.</p>
  </li>
</ul>

<h1 id="additional-resources">Additional Resources</h1>

<h2 id="section">-</h2>
<p>-</p>

    
	</div>
 

    <!-- <link href="../assets/css/f5-styles.css" rel="stylesheet" type="text/css">
<link href="../assets/css/font-awesome.css" rel="stylesheet" type="text/css">
<footer id="F5-Footer">

<div>
  <ul class="links" id="F5-Footer">
              <li>
                <p class="toggleNext toggleMobile"><span class="icon-down visible-xs-inline hidden-ie">&#8203;</span> Connect With Us</p>
                <ul class="social-media">
                    
                    <!-- en -->
                    <li><a href="//twitter.com/f5networks" target="_blank" data-name="twitter" data-type="" data-prefix="social" data-utf="E032" title="Twitter" class="externalLink"><i class="icon-twitter"></i></a> </li>
                    <li><a href="//www.linkedin.com/companies/f5-networks" target="_blank" class="linkedin externalLink" title="LinkedIn"><i class="icon-linkedin"></i></a> </li>
                    <li><a href="//www.facebook.com/f5networksinc" target="_blank" class="facebook externalLink" title="Facebook"><i class="icon-facebook"></i></a> </li>
                    <li><a href="//www.youtube.com/f5networksinc" target="_blank" class="youtube externalLink" title="YouTube"><i class="icon-youtube"></i></a> </li>
                    <li><a href="//devcentral.f5.com/" target="_blank" class="devcentral currentURL internalLink" title="DevCentral"><i class="icon-dc-pos"></i></a> </li>
                    
                </ul>
            </li>
      
  
       		<li><p class="toggleNext toggleMobile"><span class="icon-down visible-xs-inline hidden-ie">&#8203;</span>Find Us On GitHub</p>
      <ul>
      	<li>
        <a href="https://github.com/F5Networks"><span class="username">F5Networks/</span><span class="repo"></span>  
        </a>
      	</li>

      
      
	</ul>
    </li>
    </ul>
  </div>
    
<div class="back-to-top"><a><span class="icon-up">&#8203;</span></a></div>
</footer>
 -->

</body>
<script>
        $(function() {
            //Calls the tocify method on the HTML div.
            $("#toc").tocify();
        });
</script>    
</html>          

